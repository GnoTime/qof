<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN">
<html lang="en_gb">
<head>
<title>QOF - Query Object Framework</title>
<link rel="shortcut icon" href="favicon.png">
<link rel="stylesheet" type="text/css" href="qof.css">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
</head>
<body>
<h1>Packaging and building against <acronym
title="Query Object Framework">QOF</acronym></h1>
<div id="resource">
<ul>
<li><a href="index.html#intro">Introduction</a></li>
<li><a href="#roadmap">Roadmap</a></li>
<li><a href="#libsql">QOF and libgda</a></li>
<li><a href="#docs">Packaging documentation.</a></li>
<li><a href="http://sourceforge.net/projects/qof/">SourceForge</a></li>
<li><a href="index.html#docs">Documentation</a></li>
<li><a href="index.html#download">Downloads</a></li>
<li><a href="index.html#devel">Development</a></li>
<li><a href="index.html#online">Online</a></li>
<li><a href="index.html#origins">Origins</a></li>
<li><a href="index.html#functions">Function</a></li>
<li><a href="index.html#goals">Goals</a></li>
<li><a href="index.html#status">Status</a></li>
<li><a href="why-qof.html">Why QOF?</a></li>
<li><a href="http://www.data-freedom.org/">Data Freedom</a></li>
<li><a href="index.html#support">Support</a></li>
</ul>
</div>
<div><img src="qof-logo.jpg" id="qoflogo" alt="image based on the hebrew
symbol of the same name"></div>

<h2>Advice for packagers / maintainers</h2>
<h3>Updated August 2006 for QOF 0.7.1</h3>

<ul>
<li>Building against QOF
<ul>
<li><a href="#automake">AUTOMAKE example</a></li>
<li><a href="#libqof1">libqof1 API/ABI compatibility</a>.</li>
<li><a href="#required">MAX_REQUIRED specifiers</a></li>
<li><a href="#dwi">DWI is optional</a></li>
<li><a href="#osx">Mac OSX</a></li>
</ul>
</li>
<li>Packaging QOF.
<ul>
<li><a href="#la">libqof-backend-qsf.la in libqof1</a></li>
<li><a href="#libxml">libxml2 >= 2.5.10</a></li>
<li><a href="#nogtk">There is no QOF dependency on Gtk!</a></li>
<li><a href="#backend">Which backend to use?</a></li>
</ul>
</li>
<li><a href="#dev">Using libqof-dev</a></li>
</ul>

<h2>BUILDING AGAINST QOF</h2>

<h3 id="automake">AUTOMAKE</h3>
<div>To use QOF_TYPE_TIME or QofUndo, QOF_REQUIRED
needs to be set to 0.7.0 in the example below.</div>
<div>Using automake, consider this example as the basis for
your commands for in configure.ac:</div>
<pre>
dnl *************************************
dnl QOF
dnl *************************************

QOF_REQUIRED=0.7.1
AC_PATH_PROG(PKG_CONFIG, pkg-config, no)
if test pkg-config = no; then
	AC_MSG_ERROR([Please install pkgconfig])
	exit 1
fi
AC_MSG_CHECKING([for QOF - version >= $QOF_REQUIRED])
QOF=`$PKG_CONFIG --silence-errors --exists 'qof-1 >= $QOF_REQUIRED'`
QOF_LIBS=`$PKG_CONFIG --silence-errors --libs qof-1`
QOF_CFLAGS=`$PKG_CONFIG --silence-errors --cflags qof-1`
QOF_VERSION=`$PKG_CONFIG --silence-errors --modversion qof-1`
QOF_PREFIX=`$PKG_CONFIG --silence-errors --variable=prefix qof-1`
QOF_LIB_DIR=`$PKG_CONFIG --silence-errors --variable=libdir qof-1`
QOF_XML_DIR=`$PKG_CONFIG --silence-errors --variable=xmldir qof-1`

AC_SUBST(QOF_CFLAGS)
AC_SUBST(QOF_LIBS)
AC_SUBST(QOF_PREFIX)
AC_SUBST(QOF_LIB_DIR)
AC_SUBST(QOF_XML_DIR)
if test x$QOF_XML_DIR = x; then
        AC_MSG_RESULT([no])
        AC_MSG_ERROR([
        The package requires the Query Object Framework: QOF.
        You need to install QOF >= ${QOF_REQUIRED} (libqof1).
        You can find it at http://qof.sourceforge.net/
])
        exit 1
else
        AC_MSG_RESULT([yes (found $QOF_VERSION)])
fi
</pre>

<div>For more information, see the source for Pilot-QOF,
gpe-expenses or CashUtil which include an optional 
method to build from QOF CVS source as well as the package.</div>

<div>
<p><a href="http://pilot-qof.sourceforge.net/">
http://pilot-qof.sourceforge.net/</a></p>
<p><a href="http://cashutil.sourceforge.net/">
http://cashutil.sourceforge.net/</a></p>
<p><a href="http://gpe-expenses.sourceforge.net/">
http://gpe-expenses.sourceforge.net/</a></p>
</div>
<hr>
<h3 id="libqof1">libqof1 API/ABI compatibility.</h3>

<div>
<p>During the life of the QOF the 0.6.x, 0.7.x and 0.8.x trees, 
various functions will be deprecated and renamed - leaving a 
#define or deprecated version to support the old name. New code 
will be expected to use the new name and old code the deprecated 
version. Then when all such code has been sorted out, applications 
have two choices:</p>
<ol>
<li>Move to the new API with the library, or</li>
<li>Integrate the #define's in a header of their own.</li>
</ol>

<p>Either way, the deprecated functions will then be removed from 
QOF in a single operation that takes us smoothly from libqof1 to 
libqof2.</p>
</div>
<hr>
<h3 id="required">MAX_REQUIRED specifiers</h3>
<div>
<p>Some packages have previously used:</p>
<pre>LIBQOF_REQUIRED_MIN=0.5.2
LIBQOF_REQUIRED_MAX=0.5.2</pre>

<p>The MAX value is no longer required. QOF will only change the 
API/ABI on a SONAME increment. So each release of libqof1 will 
always be API/ABI compatible with previous releases of libqof1. 
It is recommended to only specify a minimum and accept any later 
version of QOF.</p>
</div>
<hr>
<h3 id="dwi">DWI is optional</h3>
<div>
<p>DWI - Data With Interaction - is a QOF backend in development 
and it has it's own SourceForge project and homepage.</p>

<p><a href="http://dwi.sourceforge.net/">
http://dwi.sourceforge.net/</a></p>

<p>DWI development seems to have stalled and it has not been tested 
against libqof1. QOF still checks for DWI but DWI is completely 
optional and there is no reason to include DWI with QOF at this 
time.</p>

<p>If you decide to try using DWI against libqof1, please report 
your results (good or bad) to the QOF-devel mailing list.</p>

<p><a href="http://lists.sourceforge.net/lists/listinfo/qof-devel">
http://lists.sourceforge.net/lists/listinfo/qof-devel</a></p>
</div>
<hr>

<h3 id="osx">Mac OSX</h3>
<div>
<p>Specify your Mac OSX compiler settings as environment variables.
e.g. for fink use:</p>
<pre>export CPPFLAGS="-I/sw/include"
export LDFLAGS="-L/sw/lib"
export LIBTOOL="glibtool"
export PATH="/sw/bin:$PATH"
export ACLOCAL_FLAGS="-I /sw/share/aclocal"
</pre>
<p>Helpful pair of settings for general manpage usage
(to go into .bashrc in your home directory):</p>
<pre>export MANPATH="/sw/share/man:&lt;build_path&gt;"
export PAGER="less -s"
</pre>

<p>To only use these for this one build, create a bash script and 
export the variables before calling ./autogen.sh</p>

<p>QOF is no longer routinely built on OSX. If you encounter 
problems, post the '<code>config.h</code>' file from the top 
directory of your build to the QOF-devel mailing list.<p>
</div>
<hr>
<h2>PACKAGING QOF</h2>

<h3 id="la">libqof-backend-qsf.la in libqof1</h3>
<div>
<h4>Updated</h4>
<p>See the section on <a href="#backend">backends</a>.</p>
</div>
<hr>
<h3 id="libxml">libxml2 &gt;= 2.5.10</h3>

<p>The version string is vital. (Earlier versions will break the QSF 
backend horribly.)</p>

<hr>
<h3 id="nogtk">There is no QOF dependency on Gtk!</h3>
<div>
<p>Do <b>not</b> list a QOF runtime or build dependency on libgtk. 
The one example that could use Gtk has now been <b>removed</b> from
the distribution tarball along with the other (outdated) examples.
</p>
<p>That's all there ever was to the Gtk stuff. It's important 
because projects like pilot-link will not accept code that links 
to GUI stuff for no good reason.</p>
</div>

<hr>
<h3 id="backend">Which backend to use?</h3>
<div>
<ul><li><b>libqof-backend-qsf0</b> : Default XML backend for most
applications.</li>
<li><b>libqof-backend-sqlite0</b> : SQLite backend intended for
embedded applications where libxml2 is simply too large for the
available storage space.</li>
<li><b>roll-your-own</b> : Some applications already have their
own backends for use via QOF.</li>
<li><b>Future backends</b> : GnomeDB support is expected for a
future QOF release. This will add a further module which in turn
allow for other plugins for libgda itself.</li>
</ul>
<p>QOF can be packaged separately from the modules but care is needed
to ensure that existing applications can locate and load the necessary
backend. Applications that cannot load the necessary backend will
typically fail to start or be unable to load or save data.</p>
<p>At present, only <a href="http://pilot-qof.sourceforge.net/">pilot-qof</a> 
supports all available QOF backends. In most cases, it is wise to ensure that
at least <b>libqof-backend-qsf0</b> is available for all existing QOF
applications. New applications and new versions of existing applications
can be configured to load new and additional backends.</p>
</div>

<hr>
<h3 id="dev">libqof-dev usage</h3>
<div>
<p>The QOF API specifies the use of:</p>
<pre>#include "qof.h"</pre>
<p>or</p>
<pre>#include &lt;qof.h&gt;</pre>
<p>- this is because some headers in
libqof-dev need to be included in the correct sequence.
Individual filenames and file contents are also subject
to change during the life of libqof1 and packages using QOF
need to only use qof.h to avoid problems moving to libqof2.</p>
</div>
<hr>

<h3 id="libsql">Replacement of lib/libsql</h3>
<h4>Updated!</h4>
<div>
<p>
The code in lib/libsql came from the libgda package
at about v1.0.3 and is now commonly available, including
on Mac OSX via fink - albeit at only v1.0.4-3.</p>

<p>Fedora Core 3 has 1.0.4, Fedora Core 4 has 1.2.0 and Debian
has 1.2.2.</p>

<p>libgda comes in stable and unstable releases. At time of
writing, the stable release is 1.2.2 (libgda2-3 in Debian).
<b>QOF does not support the unstable libgda releases.</b>
If your distribution has libgda 1.3.x or 1.9.x, please do <b>not</b>
patch QOF to use the unstable code. Instead, let QOF use it's internal
code. QOF currently uses a fraction of the libgda codebase and until
a full QOF/GDA backend is available, QOF will not be supporting
any of the unstable libgda releases.
</p>

<p>This also helps complete the CashUtil project that will need the
SQL handling in QOF and GnuCash itself which is likely to use more
SQL directly in the future.</p>
</div>

<h3 id="roadmap">Roadmap</h3>
<div>
<p>Outline plan of the next few releases. All items are subject to 
change, but this is how it looks so far.</p>

<h4>QOF 0.7.1</h4>
<ol>
<li><h4>QofNumeric</h4><p>
The next section to be converted to the QOF naming conventions will be
gnc_numeric (QofNumeric) - this will be a simple change of struct and
function names. <b>Expected : 0.7.1, September 2006.</b></p></li>

<li><h4>QSQLBackend</h4><p>
Embedded users of libqof1 will benefit from a SQLite compatible backend.
This will be a GModule that can replace the QSF Backend for embedded
systems that cannot use the ever expanding libxml2. QSQL will only be
suitable for embedded systems - it is not intended for use on larger
systems. In particular, it might not support the full range of QOF
operations. <b>Expected 0.7.1, September 2006.</b></p></li>

<li><h4>QOF/GDA Backend</h4><p>
A more comprehensive backend based on libgda is planned, supporting
various databases via GnomeDB plugins. This will not be implemented
directly on embedded systems. This could be a relatively large amount of
new code, expect for early 2007. <b>Likely to take QOF to 0.8.0, still as
libqof1.</b></p></li>

<li><h4>QofKvp</h4><p>
Various Kvp functions need to be reviewed, a KVP_TYPE_BOOLEAN is long
overdue and the split between public and private Kvp functions needs to
be completely redone. <b>Expected: Late 2006, early 2007.</b></p></li>

<li><h4>libqof2</h4><p>
Once these steps are complete, the rest of QOF will be reviewed -
including moving certain sections of code around within the codebase to
make the overview clearer and the library easier to follow. A series of
pre-releases for libqof2 can then begin. <b>Expect pre-releases Summer 2007
and libqof2, QOF 1.0.0, Autumn 2007.</b> Note that libqof2 will start with
the last release of libqof1 but with all deprecated code removed. Users
who migrate with libqof1 will be able to transfer to libqof2 without
problems. The libqof2 API will then remain stable, just as with libqof1.</p></li>
</ol>
<p>Support for GLib GObject mapping (qofgobj.c) is not currently
anticipated before QOF 0.8.0. If everything else is ready for libqof2,
libqof2 will proceed without GLib Gobject mapping.</p>

</div>

<h3 id="docs">Packaging documentation</h3>
<div>
The <i>doxy</i> symlink in the website directory is provided for CVS users and 
the main SourceForge site. When packaging the website HTML alongside
the Doxygen output, ignore the symlink and just package the Doxygen output:

<ul>
<li><code>doc/html/*</code> <b>=&gt;</b> <code>/usr/share/doc/libqof-doc/html/doxy/</code></li>
</ul>
and the website content:
<ul>
<li><code>website/*.html</code> <b>=&gt;</b> <code>/usr/share/doc/libqof-doc/html/</code></li>
<li><code>website/*.css</code> <b>=&gt;</b> <code>/usr/share/doc/libqof-doc/html/</code></li>
<li><code>website/*.png</code> <b>=&gt;</b> <code>/usr/share/doc/libqof-doc/html/</code></li>
<li><code>website/*.jpg</code> <b>=&gt;</b> <code>/usr/share/doc/libqof-doc/html/</code></li>
</ul>

</div>

<hr>
<div><p>Written by Neil Williams &lt;linux@codehelp.co.uk&gt; December 2005.
</p><p>Last updated by Neil Williams &lt;linux@codehelp.co.uk&gt; July 2006.
</p></div>
<hr>
<div><a href="http://sourceforge.net/projects/qof/">
<img src="sflogolg.png" id="sflogo" alt="SourceForge Logo"></a></div>
<div id="licence">
<p>The copyright licensing notice below applies to this text.</p>
<p>Copyright &copy; 2005,2006 Neil Williams</p>
<p>Permission is granted to copy, distribute, and/or modify this document under
the terms of the GNU Free Documentation License, Version 1.2 or any later
version published by the Free Software Foundation; with no Invariant Sections, 
with no Front-Cover Texts, and with no Back-Cover Texts. 
In installed versions, the licence can be found in the 
<a href="../copyright">copyright</a> file.</p>
</div>
</body>
</html>
